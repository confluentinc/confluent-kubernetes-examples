apiVersion: platform.confluent.io/v1beta1
kind: KRaftController
metadata:
  name: kraftcontroller
  namespace: operator
spec:
  authorization:
    superUsers:
      - User:kafka
      - User:mds
      - User:operator
    type: rbac
  dataVolumeCapacity: 10G
  image:
    application: docker.io/confluentinc/cp-server:7.8.0
    init: confluentinc/confluent-init-container:2.10.0
  listeners:
    controller:
      authentication:
        jaasConfig:
          secretRef: credential
        type: plain
      tls:
        enabled: true
  replicas: 3
  tls:
    autoGeneratedCerts: true
  dependencies:
    schemaRegistry:
      authentication:
        basic:
          secretRef: rest-credential
        type: basic
      tls:
        enabled: true
      url: https://schemaregistry.operator.svc.cluster.local:8081
    mdsKafkaCluster:
      bootstrapEndpoint: kafka.operator.svc.cluster.local:9092
      authentication:
        type: plain
        jaasConfig:
          secretRef: credential
      tls:
        enabled: true


---

apiVersion: platform.confluent.io/v1beta1
kind: Kafka
metadata:
  name: kafka
  namespace: operator
spec:
  authorization:
    superUsers:
      - User:kafka
      - User:mds
      - User:operator
    type: rbac
  dataVolumeCapacity: 10G
  dependencies:
    schemaRegistry:
      authentication:
        basic:
          secretRef: rest-credential
        type: basic
      tls:
        enabled: true
      url: https://schemaregistry.operator.svc.cluster.local:8081
    kRaftController:
      clusterRef:
        name: kraftcontroller
      controllerListener:
        authentication:
          jaasConfig:
            secretRef: credential
          type: plain
        tls:
          enabled: true
    kafkaRest:
      authentication:
        bearer:
          secretRef: mds-client-erp
        type: bearer
  image:
    application: docker.io/confluentinc/cp-server:7.8.0
    init: confluentinc/confluent-init-container:2.10.0
  listeners:
    internal:
      authentication:
        type: plain
        jaasConfig:
          secretRef: credential
      tls:
        enabled: true
    external:
      authentication:
        jaasConfig:
          secretRef: credential
        type: plain
      tls:
        enabled: true
    replication:
      authentication:
        jaasConfig:
          secretRef: credential
        type: plain
      tls:
        enabled: true
  replicas: 3
  services:
    mds:
      provider:
        ldap:
          address: ldap://ldap.operator.svc.cluster.local:389
          authentication:
            simple:
              secretRef: credential
            type: simple
          configurations:
            groupMemberAttribute: member
            groupMemberAttributePattern: CN=(.*),DC=test,DC=com
            groupNameAttribute: cn
            groupObjectClass: group
            groupSearchBase: dc=test,dc=com
            userMemberOfAttributePattern: CN=(.*),DC=test,DC=com
            userNameAttribute: cn
            userObjectClass: organizationalRole
            userSearchBase: dc=test,dc=com
          tls:
            enabled: true
        type: ldap
      tls:
        enabled: true
      tokenKeyPair:
        secretRef: mds-token
  tls:
    autoGeneratedCerts: true

---

apiVersion: platform.confluent.io/v1beta1
kind: KafkaRestClass
metadata:
  name: primary
  namespace: operator
spec:
  kafkaClusterRef:
    name: kafka
  kafkaRest:
    authentication:
      type: bearer
      bearer:
        secretRef: rest-credential

---