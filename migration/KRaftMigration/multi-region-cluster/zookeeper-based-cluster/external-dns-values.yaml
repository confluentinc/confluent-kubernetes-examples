# -- Kubernetes Service Account Configuration --
# Create a dedicated Service Account for ExternalDNS to run as.
serviceAccount:
  create: true
  # The name is left blank to be auto-generated by Helm.
  # Add the Workload Identity annotation to link the KSA to the Google SA.
  # Replace 'your-gcp-project-id' and 'gsa-name' with your actual values.
  annotations:
    iam.gke.io/gcp-service-account: external-dns-sa@platform-eng-204922.iam.gserviceaccount.com

# Allow non-standard container images

global:
  security:
    allowInsecureImages: true

# -- RBAC Configuration --
# ExternalDNS needs permissions to read Services and Ingresses.
rbac:
  create: true
  # Add the missing permission for the application to read 'endpoints'
  additionalPermissions:
    - apiGroups: [ "" ]
      resources: [ "endpoints" ]
      verbs: [ "get","watch","list" ]

# -- Provider Configuration --
# Specify Google Cloud DNS as the provider.
provider: google

# -- DNS Record Policy --
# 'sync' will create and delete records to match Kubernetes resources.
# 'upsert-only' will only create/update records, never delete them.
policy: sync

# -- Domain Filtering --
# Restrict ExternalDNS to only manage records within this hosted zone.
domainFilters:
  - platformops.dev.gcp.devel.cpdev.cloud

# -- Google Provider Specific Configuration --
# Replace 'your-gcp-project-id' with the project where your Cloud DNS zone is hosted.
# Use extraArgs to pass the required command-line flag for the provider.
extraArgs:
  - --google-project=platform-eng-204922

google:
  project: platform-eng-204922

# -- Image Configuration --
# Use the alternative image from k8s.gcr.io.
# -- Image Configuration --
image:
  repository: k8s.gcr.io/external-dns/external-dns
  tag: v0.13.2

# -- TXT Record Configuration --
# This ID helps identify which ExternalDNS instance owns a given record.
# It's crucial if you run multiple instances managing the same DNS zone.
#txtOwnerId: "external-dns-main"

# -- Resource Limits and Requests --
# Define CPU and Memory constraints for the pod.
resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 100m
    memory: 128Mi

logLevel: debug
